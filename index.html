<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Perolehan Produk - Store Name</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            padding: 30px;
            margin-top: 20px;
            transform: perspective(1000px) rotateX(0.5deg);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c);
            border-radius: 20px 20px 0 0;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
            position: relative;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo-3d {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #3498db, #2980b9);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 10px 20px rgba(52, 152, 219, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 0 0 3px rgba(255, 255, 255, 0.1);
            transform: perspective(500px) rotateY(-5deg);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .logo-3d:hover {
            transform: perspective(500px) rotateY(0deg) scale(1.05);
            box-shadow: 
                0 15px 30px rgba(52, 152, 219, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                0 0 0 3px rgba(255, 255, 255, 0.2);
        }
        
        .logo-3d::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 255, 255, 0.1) 50%, 
                transparent 70%);
            transform: rotate(45deg);
        }
        
        .logo-text {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
        }
        
        .logo-icon {
            font-size: 36px;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .store-info {
            text-align: right;
        }
        
        .store-name-input {
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            width: 300px;
            margin-top: 5px;
            background: white;
            transition: all 0.3s ease;
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.1),
                inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .store-name-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 
                0 6px 12px rgba(52, 152, 219, 0.2),
                inset 0 2px 4px rgba(52, 152, 219, 0.1);
            transform: translateY(-2px);
        }
        
        .date {
            color: #7f8c8d;
            margin-top: 5px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .main-title {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
            font-size: 28px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            padding-bottom: 15px;
        }
        
        .main-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 2px;
        }
        
        .product-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 900px) {
            .product-section {
                grid-template-columns: 1fr;
            }
        }
        
        .section-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #3498db;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .device-list, .npod-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
            padding: 15px;
            background: linear-gradient(145deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.05),
                0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .device-item, .npod-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 12px;
            border: none;
            transition: all 0.3s ease;
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.1),
                0 1px 3px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }
        
        .device-item::before, .npod-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #3498db, #2ecc71);
            transition: width 0.3s ease;
        }
        
        .device-item:hover, .npod-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 10px 20px rgba(52, 152, 219, 0.2),
                0 6px 6px rgba(0, 0, 0, 0.1);
            background: linear-gradient(145deg, #ffffff, #eef5ff);
        }
        
        .device-item:hover::before, .npod-item:hover::before {
            width: 6px;
        }
        
        .device-label, .npod-label {
            font-size: 15px;
            flex-grow: 1;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            margin-left: 10px;
        }
        
        .quantity-btn {
            width: 36px;
            height: 36px;
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 
                0 4px 6px rgba(52, 152, 219, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .quantity-btn:hover {
            background: linear-gradient(145deg, #2980b9, #3498db);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 8px rgba(52, 152, 219, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .quantity-btn:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 4px rgba(52, 152, 219, 0.3),
                inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .quantity-input {
            width: 70px;
            height: 36px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin: 0 8px;
            font-size: 16px;
            font-weight: 600;
            background: white;
            transition: all 0.3s ease;
        }
        
        .quantity-input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            transform: scale(1.05);
        }
        
        .unit {
            margin-left: 8px;
            color: #7f8c8d;
            font-size: 14px;
            min-width: 30px;
            font-weight: 500;
        }
        
        .submit-section {
            background: linear-gradient(145deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .submit-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3498db, #2ecc71);
        }
        
        .submit-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #2c3e50;
            font-weight: 700;
        }
        
        .submit-instructions {
            color: #666;
            margin-bottom: 25px;
            font-size: 16px;
            line-height: 1.5;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .summary-info {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transform: perspective(500px) rotateX(1deg);
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 2px dashed #eee;
            font-size: 16px;
        }
        
        .summary-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
            font-weight: bold;
            font-size: 20px;
            color: #2c3e50;
            padding-top: 10px;
            border-top: 2px solid #eee;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 16px 45px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 180px;
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 15px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 12px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }
        
        .btn:active {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 10px rgba(0, 0, 0, 0.15),
                inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-reset {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-reset:hover {
            background: linear-gradient(145deg, #c0392b, #e74c3c);
        }
        
        .btn-submit {
            background: linear-gradient(145deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-submit:hover {
            background: linear-gradient(145deg, #27ae60, #2ecc71);
        }
        
        .btn-submit:disabled {
            background: linear-gradient(145deg, #95a5a6, #7f8c8d);
            cursor: not-allowed;
            transform: none;
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .btn-submit:disabled:hover::before {
            left: -100%;
        }
        
        .btn-refresh {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-refresh:hover {
            background: linear-gradient(145deg, #2980b9, #3498db);
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            padding: 20px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .message {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 500;
            display: none;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            transform: perspective(500px) rotateX(2deg);
            border-left: 5px solid;
        }
        
        .message.success {
            background: linear-gradient(145deg, #d5edda, #c3e6cb);
            color: #155724;
            border-color: #2ecc71;
            display: block;
        }
        
        .message.error {
            background: linear-gradient(145deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-color: #e74c3c;
            display: block;
        }
        
        .selected-count {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            margin-left: 8px;
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.3);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-style: italic;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 10px;
            border: 2px dashed #ddd;
        }
        
        .product-count {
            font-size: 14px;
            color: #3498db;
            margin-left: 10px;
            font-weight: 600;
            background: rgba(52, 152, 219, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
        }
        
        /* Scrollbar styling */
        .device-list::-webkit-scrollbar,
        .npod-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .device-list::-webkit-scrollbar-track,
        .npod-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .device-list::-webkit-scrollbar-thumb,
        .npod-list::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            border-radius: 4px;
        }
        
        .device-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #2980b9, #3498db);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo-3d">
                    <div class="logo-icon">NC</div>
                </div>
                <div class="logo-text">NICOTECH<br>SYSTEM</div>
            </div>
            <div class="store-info">
                <div>
                    <label for="storeName" style="font-weight: 600; color: #2c3e50;">STORE NAME:</label>
                    <input type="text" id="storeName" class="store-name-input" placeholder="Enter store name" required>
                </div>
                <div class="date" id="currentDate">DATE: February 6, 2026</div>
            </div>
        </div>
        
        <h1 class="main-title">Product Selection System</h1>
        
        <div id="message" class="message success" style="display: none;">Success! Order for fovc submitted. Total: 48 items (3 devices, 6 NPODs).</div>
        
        <div class="product-section">
            <div class="device-selection">
                <h2 class="section-title">
                    Device Selection 
                    <span id="deviceCount" class="product-count">3 items with quantity</span>
                </h2>
                <div class="device-list" id="deviceList">
                    <!-- Device items will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="npod-selection">
                <h2 class="section-title">
                    NPOD Selection 
                    <span id="npodCount" class="product-count">6 items with quantity</span>
                </h2>
                <div class="npod-list" id="npodList">
                    <!-- NPOD items will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="submit-section">
            <h2 class="submit-title">Submit Your Order</h2>
            <p class="submit-instructions">
                Enter the quantity for each product you want to order. Leave it empty or set to 0 if you don't want that product.
                After entering all quantities, click the Submit button to send your order to our system.
            </p>
            
            <div class="summary-info">
                <div class="summary-row">
                    <span>Devices with quantity:</span>
                    <span id="summaryDeviceCount">3</span>
                </div>
                <div class="summary-row">
                    <span>NPODs with quantity:</span>
                    <span id="summaryNpodCount">6</span>
                </div>
                <div class="summary-row">
                    <span>Total items in order:</span>
                    <span id="summaryTotalItems">48</span>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-reset" id="resetBtn">Clear All</button>
                <button class="btn btn-submit" id="submitBtn">Submit Order</button>
                <button class="btn btn-refresh" id="refreshBtn" style="display: none;">Start New Order</button>
            </div>
            
            <p class="submit-instructions" style="margin-top: 25px; font-size: 14px;">
                <strong>Note:</strong> Please ensure you have entered your store name and at least one quantity before submitting.
            </p>
        </div>
        
        <div class="footer">
            <p>Sistem Perolehan Produk Â© 2023 | Data akan dihantar ke Google Sheets</p>
        </div>
    </div>

    <script>
        // Set current date
        function setCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = now.toLocaleDateString('en-US', options);
            document.getElementById('currentDate').textContent = `DATE: ${formattedDate}`;
        }
        
        // Device data
        const devices = [
            "Ncig pro Embered",
            "Ncig pro Pine",
            "Ncig Pro Glacier",
            "Ncig Pro Midnight",
            "Ncig Pro Sangria",
            "Ncig Pro Kendal",
            "Ncig Pro Tifanny",
            "Ncig Pro Sage",
            "Ncig One Obsidian",
            "Ncig One Pacific",
            "Ncig One Scarlet",
            "Ncig Cube Ocean",
            "Ncig Cube Ash",
            "Ncig Cube Lava",
            "Ncig Cube Sky",
            "Ncig Cube Neon",
            "Ncig Cube Slate"
        ];
        
        // NPOD data
        const npods = [
            "TOBACCO (RED)",
            "Banana Vanilla",
            "TOBACCO (WHITE)",
            "PECAN",
            "BERRY TOAST",
            "Coffee",
            "COFFEE",
            "GRAPE",
            "GUAVA",
            "LEMON",
            "KELADI",
            "MANGO",
            "BERRY",
            "MINT",
            "STRAWBERRY",
            "TEA",
            "VANILLA",
            "WATERMELON MINT"
        ];
        
        // Store selected items
        let selectedDevices = {};
        let selectedNpods = {};
        
        // Submission flags
        let isSubmitting = false;
        let hasSubmitted = false;
        
        // Initialize the application
        function init() {
            setCurrentDate();
            populateDeviceList();
            populateNpodList();
            setupEventListeners();
            
            // Load saved data if exists
            loadSavedData();
            
            // Update summary
            updateSummary();
        }
        
        // Populate device list
        function populateDeviceList() {
            const deviceList = document.getElementById('deviceList');
            deviceList.innerHTML = '';
            
            devices.forEach(device => {
                const deviceId = device.replace(/\s+/g, '-').toLowerCase();
                
                const deviceItem = document.createElement('div');
                deviceItem.className = 'device-item';
                deviceItem.id = `device-${deviceId}`;
                
                deviceItem.innerHTML = `
                    <label class="device-label" for="qty-${deviceId}">${device}</label>
                    <div class="quantity-control">
                        <button class="quantity-btn minus" data-device="${device}">-</button>
                        <input type="number" class="quantity-input" id="qty-${deviceId}" 
                               placeholder="0" min="0" max="99" data-device="${device}">
                        <button class="quantity-btn plus" data-device="${device}">+</button>
                        <span class="unit">pcs</span>
                    </div>
                `;
                
                deviceList.appendChild(deviceItem);
            });
        }
        
        // Populate NPOD list
        function populateNpodList() {
            const npodList = document.getElementById('npodList');
            npodList.innerHTML = '';
            
            npods.forEach(npod => {
                const npodId = npod.replace(/\s+/g, '-').replace(/[()]/g, '').toLowerCase();
                
                const npodItem = document.createElement('div');
                npodItem.className = 'npod-item';
                npodItem.id = `npod-${npodId}`;
                
                npodItem.innerHTML = `
                    <label class="npod-label" for="npod-qty-${npodId}">${npod}</label>
                    <div class="quantity-control">
                        <button class="quantity-btn minus" data-npod="${npod}">-</button>
                        <input type="number" class="quantity-input" id="npod-qty-${npodId}" 
                               placeholder="0" min="0" max="99" data-npod="${npod}">
                        <button class="quantity-btn plus" data-npod="${npod}">+</button>
                        <span class="unit">pcs</span>
                    </div>
                `;
                
                npodList.appendChild(npodItem);
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Quantity button clicks
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('quantity-btn')) {
                    const isMinus = e.target.classList.contains('minus');
                    const isPlus = e.target.classList.contains('plus');
                    const device = e.target.getAttribute('data-device');
                    const npod = e.target.getAttribute('data-npod');
                    
                    if (device) {
                        const deviceId = device.replace(/\s+/g, '-').toLowerCase();
                        const quantityInput = document.getElementById(`qty-${deviceId}`);
                        let quantity = parseInt(quantityInput.value) || 0;
                        
                        if (isMinus && quantity > 0) {
                            quantity--;
                        } else if (isPlus && quantity < 99) {
                            quantity++;
                        }
                        
                        quantityInput.value = quantity;
                        updateQuantity(device, quantity, 'device');
                    }
                    
                    if (npod) {
                        const npodId = npod.replace(/\s+/g, '-').replace(/[()]/g, '').toLowerCase();
                        const quantityInput = document.getElementById(`npod-qty-${npodId}`);
                        let quantity = parseInt(quantityInput.value) || 0;
                        
                        if (isMinus && quantity > 0) {
                            quantity--;
                        } else if (isPlus && quantity < 99) {
                            quantity++;
                        }
                        
                        quantityInput.value = quantity;
                        updateQuantity(npod, quantity, 'npod');
                    }
                }
            });
            
            // Quantity input changes
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('quantity-input')) {
                    const device = e.target.getAttribute('data-device');
                    const npod = e.target.getAttribute('data-npod');
                    const quantity = parseInt(e.target.value) || 0;
                    
                    if (device) {
                        updateQuantity(device, quantity, 'device');
                    }
                    
                    if (npod) {
                        updateQuantity(npod, quantity, 'npod');
                    }
                }
            });
            
            // Reset button
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all quantities?')) {
                    resetAll();
                }
            });
            
            // Submit button
            document.getElementById('submitBtn').addEventListener('click', function() {
                submitOrder();
            });
            
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to start a new order? The current form will be reset.')) {
                    location.reload();
                }
            });
            
            // Store name input
            document.getElementById('storeName').addEventListener('input', function() {
                updateSubmitButton();
                saveData();
            });
        }
        
        // Update quantity in selected items
        function updateQuantity(product, quantity, type) {
            if (type === 'device') {
                if (quantity > 0) {
                    selectedDevices[product] = quantity;
                } else {
                    delete selectedDevices[product];
                }
            } else if (type === 'npod') {
                if (quantity > 0) {
                    selectedNpods[product] = quantity;
                } else {
                    delete selectedNpods[product];
                }
            }
            
            updateSummary();
            saveData();
        }
        
        // Update summary and counts
        function updateSummary() {
            const deviceCount = Object.keys(selectedDevices).length;
            const npodCount = Object.keys(selectedNpods).length;
            const totalDeviceQty = Object.values(selectedDevices).reduce((sum, qty) => sum + qty, 0);
            const totalNpodQty = Object.values(selectedNpods).reduce((sum, qty) => sum + qty, 0);
            const totalItems = totalDeviceQty + totalNpodQty;
            
            // Update counts
            document.getElementById('deviceCount').textContent = `${deviceCount} items with quantity`;
            document.getElementById('npodCount').textContent = `${npodCount} items with quantity`;
            
            // Update summary info
            document.getElementById('summaryDeviceCount').textContent = deviceCount;
            document.getElementById('summaryNpodCount').textContent = npodCount;
            document.getElementById('summaryTotalItems').textContent = totalItems;
            
            // Update submit button
            updateSubmitButton();
        }
        
        // Update submit button state
        function updateSubmitButton() {
            const submitBtn = document.getElementById('submitBtn');
            const storeName = document.getElementById('storeName').value.trim();
            const deviceCount = Object.keys(selectedDevices).length;
            const npodCount = Object.keys(selectedNpods).length;
            
            if ((deviceCount > 0 || npodCount > 0) && storeName !== '' && !hasSubmitted) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }
        
        // Show message
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            // Auto hide success messages after 8 seconds
            if (type === 'success') {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 8000);
            }
        }
        
        // Reset all selections
        function resetAll() {
            // Reset submission flags
            isSubmitting = false;
            hasSubmitted = false;
            
            // Reset submit button
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submit Order';
            submitBtn.style.background = 'linear-gradient(145deg, #2ecc71, #27ae60)';
            
            // Hide refresh button
            document.getElementById('refreshBtn').style.display = 'none';
            
            // Enable all inputs and buttons
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.disabled = false;
            });
            
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.disabled = false;
                btn.style.background = 'linear-gradient(145deg, #3498db, #2980b9)';
                btn.style.cursor = 'pointer';
            });
            
            // Enable store name input
            document.getElementById('storeName').disabled = false;
            
            // Clear selections
            selectedDevices = {};
            selectedNpods = {};
            
            // Reset all quantities to empty
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.value = '';
                input.placeholder = '0';
            });
            
            // Clear store name
            document.getElementById('storeName').value = '';
            
            // Update summary
            updateSummary();
            
            // Clear saved data
            localStorage.removeItem('storeSelectionData');
            
            // Hide any message
            document.getElementById('message').style.display = 'none';
            
            showMessage('All quantities have been cleared. You can start a new order.', 'success');
        }
        
        // Submit order to Google Sheets
        function submitOrder() {
            // Cek jika sudah submit
            if (hasSubmitted) {
                showMessage('You have already submitted this order. Please click "Start New Order" to begin a new order.', 'error');
                return;
            }
            
            // Cek jika sedang submit
            if (isSubmitting) {
                showMessage('Your order is being submitted. Please wait...', 'error');
                return;
            }
            
            const storeName = document.getElementById('storeName').value.trim();
            const currentDate = document.getElementById('currentDate').textContent.replace('DATE: ', '');
            
            if (!storeName) {
                showMessage('Please enter your store name before submitting.', 'error');
                return;
            }
            
            if (Object.keys(selectedDevices).length === 0 && Object.keys(selectedNpods).length === 0) {
                showMessage('Please enter at least one quantity before submitting.', 'error');
                return;
            }
            
            // Confirmation dialog
            if (!confirm(`Are you sure you want to submit this order for ${storeName}?\n\nDevices with quantity: ${Object.keys(selectedDevices).length}\nNPODs with quantity: ${Object.keys(selectedNpods).length}`)) {
                return;
            }
            
            // Set submitting flag
            isSubmitting = true;
            
            // Disable submit button and show loading
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span>Submitting...';
            
            // Prepare data for submission
            const formData = {
                storeName: storeName,
                date: currentDate,
                devices: selectedDevices,
                npods: selectedNpods,
                timestamp: new Date().toISOString()
            };
            
            // Simulate submission to Google Sheets
            sendToGoogleSheets(formData, submitBtn, originalText);
        }
        
       function sendToGoogleSheets(formData, submitBtn, originalText) {

    fetch("https://script.google.com/macros/s/AKfycbzZ5nJsFguVKW7xHMC5SGhlPK97iwdD0FYjc5e489e3hot5TtYfE0NgClYHo5nSmpmSRg/exec", {
        method: "POST",
        mode: "no-cors",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            storeName: formData.storeName,
            deviceSelection: formatItems(formData.devices),
            npodSelection: formatItems(formData.npods)
        })
    })
    .then(() => {
        isSubmitting = false;
        hasSubmitted = true;
        submitBtn.disabled = false;
        submitBtn.textContent = 'Already Submitted';
    })
    .catch(error => {
        console.error(error);
    });
}

function formatItems(items) {
    let result = [];
    for (let key in items) {
        result.push(`${key} (${items[key]})`);
    }
    return result.join(", ");
}



        // Save data to localStorage
        function saveData() {
            if (hasSubmitted) return;
            
            const storeName = document.getElementById('storeName').value;
            
            const saveData = {
                storeName: storeName,
                selectedDevices: selectedDevices,
                selectedNpods: selectedNpods,
                deviceQuantities: {},
                npodQuantities: {}
            };
            
            // Save all quantity inputs
            document.querySelectorAll('.quantity-input').forEach(input => {
                const device = input.getAttribute('data-device');
                const npod = input.getAttribute('data-npod');
                const value = input.value;
                
                if (device) {
                    saveData.deviceQuantities[device] = value;
                }
                
                if (npod) {
                    saveData.npodQuantities[npod] = value;
                }
            });
            
            localStorage.setItem('storeSelectionData', JSON.stringify(saveData));
        }
        
        // Load saved data from localStorage
        function loadSavedData() {
            if (hasSubmitted) return;
            
            const savedData = localStorage.getItem('storeSelectionData');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // Load store name
                    if (data.storeName) {
                        document.getElementById('storeName').value = data.storeName;
                    }
                    
                    // Load device quantities
                    if (data.deviceQuantities) {
                        Object.entries(data.deviceQuantities).forEach(([device, quantity]) => {
                            const deviceId = device.replace(/\s+/g, '-').toLowerCase();
                            const quantityInput = document.getElementById(`qty-${deviceId}`);
                            
                            if (quantityInput && quantity) {
                                quantityInput.value = quantity;
                                const qtyNum = parseInt(quantity) || 0;
                                if (qtyNum > 0) {
                                    selectedDevices[device] = qtyNum;
                                }
                            }
                        });
                    }
                    
                    // Load NPOD quantities
                    if (data.npodQuantities) {
                        Object.entries(data.npodQuantities).forEach(([npod, quantity]) => {
                            const npodId = npod.replace(/\s+/g, '-').replace(/[()]/g, '').toLowerCase();
                            const quantityInput = document.getElementById(`npod-qty-${npodId}`);
                            
                            if (quantityInput && quantity) {
                                quantityInput.value = quantity;
                                const qtyNum = parseInt(quantity) || 0;
                                if (qtyNum > 0) {
                                    selectedNpods[npod] = qtyNum;
                                }
                            }
                        });
                    }
                    
                    // Update summary
                    updateSummary();
                    
                } catch (error) {
                    console.error('Error loading saved data:', error);
                }
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
